<a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fas fa-envelope fa-fw"></i>
    {% if totalUnread > 0 %}
        <span class="badge badge-danger badge-counter">{{ totalUnread > 9 ? '9+' : totalUnread }}</span>
    {% endif %}
</a>
<!-- Dropdown - Messages -->
<div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
    aria-labelledby="messagesDropdown">
    <h6 class="dropdown-header">
        {{ 'recommendations.latest'|trans }}
    </h6>
    {% for note in notifications %}
        <a class="dropdown-item d-flex align-items-center" href="{{ path('app_user_report_show', {id: note.report.id}) }}" onclick="markNotificationAsRead({{ note.id }})">
            <div class="dropdown-list-image mr-3">
                <div class="icon-circle bg-info">
                    <i class="fas fa-brain text-white"></i>
                </div>
            </div>
            <div class="{{ note.readByUser ? 'text-gray-500' : 'font-weight-bold' }}">
                <div class="text-truncate" style="max-width: 250px;">{{ note.content|striptags|slice(0, 50) }}...</div>
                <div class="small text-gray-500">{{ note.report.title }} Â· {{ note.createdAt|date('H:i') }}</div>
            </div>
        </a>
    {% else %}
        <a class="dropdown-item text-center small text-gray-500" href="#">{{ 'recommendations.none'|trans }}</a>
    {% endfor %}
    <a class="dropdown-item text-center small text-gray-500" href="{{ path('app_recommendation') }}">{{ 'ai.insights'|trans }}</a>

</div>

<script>
function markNotificationAsRead(id) {
    fetch('/notifications/read/' + id)
        .then(response => response.json())
        .then(data => {
            console.log('Notification ' + id + ' marked as read');
        });
}
</script>
